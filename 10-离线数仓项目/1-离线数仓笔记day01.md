# 离线电商数仓项目
 # 数仓开发
 
 ## 1- 概念
 
 - 业务过程：可以概括为一个个不可拆分的行为事件，例如电商交易中的下单，取消订单，付款，退单等，都是业务过程。
 - 
 
 ## 1-数仓建模方法论
 
 ### ER模型
 
 - 实体关系模型
 - 数据库规范化(三范式)：减少数据冗余，增强数据的一致性
 
 这种建模方法的出发点是整合数据，其目的是将整个企业的数据进行组合和合并。并进行规范处理，减少数据冗余性，保证数据的一致性。这种模型并不适合直接用于分析统计。
 
 
 
 ### 维度模型
 
 维度模型将复杂的业务通过**事实**和**维度**两个概念进行呈现
 
 事实通常对应的是业务过程，而维度通常对应的是业务过程发生时所处的环境
 
 注：业务过程可以概括为**一个个不可拆分的行为事件**，比如说电商交易钟的下单，取消订单，付款，退单等等，这些都是一个行为事件，都是业务过程
 
 ```properties
 下图为一个典型的维度模型，其中位于中心的SalesOrder为事实表，其中保存的是下单这个业务过程的所有记录。位于周围每张表都是维度表，包括Date（日期），Customer（顾客），Product（产品），Location（地区）等，这些维度表就组成了每个订单发生时所处的环境，即何人、何时、在何地下单了何种产品。从图中可以看出，模型相对清晰、简洁。
 ```
 
 ![1651296055399](assets/1651296055399.png)
 
 
 
 ### 维度建模理论
 
 #### 1-事实表
 
 事实表作为数仓维度建模的核心，紧紧围绕着业务过程来设计。其中包含与该业务过程有关的维度引用(维度表外键)以及该业务过程的度量(通常是可累加的数字类型字段)。
 
 特点：通常比较细长，即列比较少，但行比较多，且行的增速很快
 
 分类：
 
 - 事务事实表
 - 周期快照事实表
 - 累积快照事实表
 
 ##### 事务事实表
 
 事务性事实表是用来记录各雨雾过程的，它保存的是各业务过程的原子操作事件。即最细粒度的操作事件。粒度是指事实表中一行数据所表达的业务细节程度。
 
 1 - 设计流程
 
 设计事务性事实表一般可遵循以下四个步骤：
 
 ​	<font color="red"> 选择业务过程 -> 声明粒度 -> 确认维度 -> 确认事实</font> 
 
 - 选择业务过程：在业务系统中，挑选我们感兴趣的业务过程，业务过程可以概括为一个个不可拆分的行为事件，例如电商交易中的下单，取消订单，付款，退单等都是业务过程。通常情况下，一个业务过程对应一张事务型事实表
 
 - 声明粒度：精确定义每张事务型事实表的每行数据表示什么，应该尽可能的选择最细粒度，以此来应对各种细节程度的需求
 
   举例：**典型的粒度声明如下**：订单事实表中一行数据表示的是一个订单中的一个商品项。
 
 - 确认维度：确定维度时应尽量多的选择与业务过程相关的环境信息。因为维度的丰富程度就决定了维度模型能够支持的指标丰富程度。
 
 - 确认事实：此处的“事实”一词，指的是每个业务过程的度量值（通常是可累加的数字类型的值，例如：次数、个数、件数、金额等）
 
 ##### 周期型快照事实表
 
 周期快照事实表以具有规律性的、可预见的时间间隔来记录事实，主要用于分析一些存量型（例如商品库存，账户余额）或者状态型（空气温度，行驶速度）指标。
 
 1-设计流程：
 
 确认粒度-> 确认事实
 
 - 确认粒度：周期型快照事实表的粒度可由采样周期和维度描述，故确定采样周期和维度后即可确定粒度。
 
   采样周期通常选择每日。
 
   维度可根据统计指标决定，例如指标为统计每个仓库中每种商品的库存，则可确定维度为仓库和商品。
 
   确定完采样周期和维度后，即可确定该表粒度为每日-仓库-商品。
 
 - 确认事实：事实也可根据统计指标决定，例如指标为统计每个仓库中每种商品的库存，则事实为商品库存。
 
 ##### 累积型快照事实表
 
 累计快照事实表是基于一个业务流程中的多个关键业务过程联合处理而构建的事实表，如交易流程中的下单、支付、发货、确认收货业务过程。
 
 累积型快照事实表通常具有多个日期字段，每个日期对应业务流程中的一个关键业务过程（里程碑）。
 
 1-设计流程
 
 累积型快照事实表的设计流程同事务型事实表类似，也可采用以下四个步骤，下面重点描述与事务型事实表的不同之处。
 
 ​	<font color="red"> 选择业务过程 -> 声明粒度 -> 确认维度 -> 确认事实</font> 
 
 - 选择业务过程
 
   选择一个业务流程中需要关联分析的多个关键业务过程，多个业务过程对应一张累积型快照事实表
 
 - 声明粒度
 
   精确定义每行数据表示的是什么，尽量选择最小的粒度
 
 - 确认维度：选择与各业务过程相关的维度，需要注意的是， 每个业务过程均需要一个日期维度
 - 确认事实：选择各业务过程的度量值
 
 #### 2-维度表
 
 前面提到事实表紧紧围绕业务过程进设计，而维度表则围绕业务过程所处的环境进行设计。维度表主要包含一个主键和各种维度字段，维度字段称为维度属性。
 
 1） 确认维度（表）
 
 ​	在设计事实表时，已经确定了与每个事实表相关的维度，理论上每个相关维度均需对应一张维度表。需要注意到，可能存在多个事实表与同一个维度都相关的情况，这种情况需保证维度的唯一性，即只创建一张维度表。另外，如果某些维度表的维度属性很少，例如只有一个名称，则可不创建该维度表，而把该表的维度属性直接增加到与之相关的事实表中，这个操作称为**<font color='red'>维度退化</font>**。
 
 2）确定主维表和相关维表
 
 此处的主维表和相关维表均指**业务系统**中与某维度相关的表。例如业务系统中与商品相关的表有sku_info，spu_info，base_trademark，base_category3，base_category2，base_category1等，其中sku_info就称为商品维度的主维表，其余表称为商品维度的相关维表。维度表的粒度通常与主维表相同。
 
 3）确定维度属性
 
 确定维度属性即确定维度表字段。维度属性主要来自于业务系统中与该维度对应的主维表和相关维表。维度属性可直接从主维表或相关维表中选择，也可通过进一步加工得到。
 
 确定维度属性时，需要遵循以下要求：
 
 **（1）尽可能生成丰富的维度属性**
 
 **（2）尽量不使用编码，而使用明确的文字说明，一般可以编码和文字共存。**
 
 **（3）尽量沉淀出通用的维度属性**
 
 
 
 ## 2-数据仓库设计
 
 ### 分层规划
 
 - ODS(原始数据层): 存放未经过处理的原始数据，结构上与源系统保持一致，是数据仓库的数据准备区
 - DWD(明细数据层)：基于维度建模理论进行构建，存放维度模型中的事实表，保存各业务过程最小粒度的操作记录
 - DWS(汇总数据层)：基于上层的指标需求，以分析的主题对象作为建模驱动，构建公共统计粒度的汇总表
 - ADS(数据应用层)：存放各项统计指标结果
 - DIM（公共维度层）：基于维度建模理论进行构建，存放维度模型中的维度表，保存一致性维度信息
 
 ### 数据仓库构建流程
 
 ![1651370065688](assets/1651370065688.png)
 
 #### 数据调研
 
  1）业务调研
 
 主要目标是熟悉业务流程、熟悉业务数据
 
 ​        熟悉业务流程、明确每个业务的具体流程，需要将该业务所包含的每个<font color='red'>业务过程</font>一一列举出来
 
 ​	熟悉业务数据要求做到将业务数据与业务过程对应起来，明确每个业务过程会对哪些表的数据产生影响，以及产生什么影响  注意：需要具体到是新增一条数据，还是修改一条数据，并且需要明确新增加的内容或者是修改的逻辑
 
 2）需求分析
 
 ​	典型的需求指标如，最近一天各省份手机品类订单总额    
 
 ​	分析上述需求：所求的指标是订单总额，那么所需的业务过程就是下单，订单表，维度的话是最近一天，那么就需要时间维度，各省份的话就需要地区省份维度，手机品类就需要categrouy品类维度
 
 - <font color='red'>分析需求时，需要明确所需的业务过程及维度</font>
 
 3）总结
 
 ​      做完业务分析和需求分析之后，要保证每个需求都能找到与之对应的业务过程及维度。若现有数据无法满足需求，则需要和业务方进行沟通，例如某个页面需要新增某个行为的埋点。
 
 #### 明确数据域
 
 数据仓库设计需要横向分层外，通常也需要根据业务情况进行纵向划分数据域，划分数据域的意义是<font color='red'>便于数据的管理和应用</font>
 
 - 其实说白了就是对数据进行分类（方便开发人员后续找到该数据）
 
 通常可以根据业务过程或者部门进行划分，本项目根据业务过程进行划分
 
 **注意：**是一个业务过程只能属于一个数据域。
 
 下面是电商数仓项目所需的所有业务过程及数据域划分详情。
 
 | **数据域** | **业务过程**                                       |
 | ---------- | -------------------------------------------------- |
 | **交易域** | 加购、下单、取消订单、支付成功、退单、退款成功     |
 | **流量域** | 页面浏览、启动应用、动作、曝光、错误               |
 | **用户域** | 注册、登录                                         |
 | **互动域** | 收藏、评价                                         |
 | **工具域** | 优惠券领取、优惠券使用（下单）、优惠券使用（支付） |
 
 #### 构建业务总线矩阵
 
 业务总线矩阵中包含维度模型所需的所有事实（业务过程）以及维度，以及各业务过程与各维度的关系。矩阵的行是一个个业务过程，矩阵的列是一个个的维度，行列的交点表示业务过程与维度的关系。
 
 一个业务过程对应维度模型中一张事务型 事实表，一个维度则对应维度模型中的一张维度表。所以构建业务总线矩阵的过程就是设计维度模型的过程。但是需要注意的是，总线矩阵中通常只包含事务型事实表，另外两种类型的事实表需单独设计。
 
 按照事务型事实表的设计流程，**选择业务过程->声明粒度->确认维度->确认事实**，得到的最终的业务总线矩阵见以下表格。
 
 ![1651447387202](assets/1651447387202.png)
 
 #### 明确统计指标
 
 指标体系相关概念：
 
 ​	<font color='red'>原子指标</font>：原子指标基于某一**业务过程**的**度量值**，是业务定义中不可再拆解的指标，原子指标的核心功能就是对指标的**聚合逻辑**进行了定义。我们可以得出结论，
 
 **原子指标包含三要素，分别是业务过程、度量值和聚合逻辑。**
 
 例如**订单总额**就是一个典型的原子指标，其中的业务过程为用户下单、度量值为订单金额，聚合逻辑为sum()求和。需要注意的是原子指标只是用来辅助定义指标一个概念，通常不会对应有实际统计需求与之对应。
 
 ​	<font color='red'>派生指标</font>：
 
 派生指标= 原子指标+ 统计周期+业务限定+统计粒度
 
 ![1651447775120](assets/1651447775120.png)
 
 
 
 ​	<font color='red'>衍生指标</font>：衍生指标是在一个或多个派生指标的基础上，通过各种逻辑运算复合而成的。例如比率、比例等类型的指标。衍生指标也会对应实际的统计需求。
 
 ![1651448199801](assets/1651448199801.png)
 
 需求分析：列的思维导图
 
 ![1651449054539](assets/1651449054539.png)
 
 #### 维度模型设计
 
 #### 汇总模型设计
 
 汇总模型的设计参考上述整理出的指标体系（主要是派生指标）即可。汇总表与派生指标的对应关系是，**一张汇总**表通常**包含**业务过程相同、统计周期相同、统计粒度相同的**多个派生指标**。
 
 放在一张汇总表：业务过程，统计周期，统计粒度
 
 
 
 ## 3-数据开发
 
 ### 1-ODS
 
 贴源层，直接拉过来，按天分区
 
 ### 2-DIM维度层
 
 首先确认好维度后，然后确认主维表和相关维表，然后进行语句装载
 
 是有五个维度表分别是
 
 - 地区维度表
 - 商品维度表
 - 活动维度表
 - 优惠券维度表
 - 用户维度表
 
 ### 3-DWD明细层
 
 #### 交易域 已做
 
 加购物车事实表： 主表是加购表然后关联码表
 
 下单事务事实表：主表是订单明细表关联订单信息表关联订单活动表和订单优惠券表以及码表
 
 取消订单事务事实表：
 
 支付成功事务事实表：
 
 退单事务事实表：
 
 退款成功事务事实表
 
 
 
 #### 工具域：已做
 
 #### 互动域：已做
 
 #### 流量域： xxx未做-+
 
 
 
 
 
 页面浏览事务事实表
 
 ## 4-ADS层指标开发
 
 #### 流量主题
 
 各渠道流量统计
 
 路径分析
 
 ### 用户主题
 
 用户变动统计
 
 用户留存率
 
 用户新增活跃统计
 
 用户行为 漏斗分析
 
 新增交易用户统计
 
